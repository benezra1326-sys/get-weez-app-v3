# Configuration Rabbit pour Reviews Automatiques de Code
# Get Weez - ChatInterface Optimization Project

version: "1.0"

# Triggers pour dÃ©clencher les reviews
triggers:
  - push
  - pull_request
  - manual

# RÃ¨gles d'analyse pour le projet
rules:
  # ===============================
  # RÃˆGLES DE QUALITÃ‰ DE CODE
  # ===============================
  
  - name: "No Console Logs in Production"
    pattern: "**/*.js"
    type: "code_quality"
    severity: "error"
    checks:
      - rule: "no_console_statements"
        message: "âŒ Console.log dÃ©tectÃ© - utilisez un logger conditionnel"
        fix_suggestion: "Remplacer par: process.env.NODE_ENV === 'development' && console.log(...)"
  
  - name: "File Size Limit"
    pattern: "components/**/*.js"
    type: "architecture"
    severity: "warning"
    checks:
      - rule: "max_lines"
        threshold: 200
        message: "âš ï¸ Fichier trop volumineux ({lines} lignes) - ConsidÃ©rer la refactorisation"
        fix_suggestion: "Diviser en composants plus petits selon le principe de responsabilitÃ© unique"
  
  - name: "No Inline Styles"
    pattern: "**/*.js"
    type: "code_quality" 
    severity: "warning"
    checks:
      - rule: "no_inline_styles"
        threshold: 5
        message: "ğŸ¨ Trop de styles inline ({count}) - Utiliser CSS modules ou styled-components"
        fix_suggestion: "Extraire les styles vers un fichier sÃ©parÃ©"

  # ===============================
  # RÃˆGLES DE PERFORMANCE REACT
  # ===============================
  
  - name: "React Performance Optimization"
    pattern: "components/**/*.js"
    type: "performance"
    severity: "info"
    checks:
      - rule: "missing_react_memo"
        message: "âš¡ ConsidÃ©rer React.memo pour ce composant lourd"
        condition: "component_has_props && lines > 50"
      
      - rule: "callback_memoization"
        message: "ğŸ”„ Callbacks non mÃ©morisÃ©s dÃ©tectÃ©s - utiliser useCallback"
        pattern: "onClick|onChange|onSubmit"
      
      - rule: "effect_dependencies"
        message: "ğŸ”— DÃ©pendances useEffect manquantes ou excessives"
        severity: "warning"

  # ===============================
  # RÃˆGLES D'ARCHITECTURE
  # ===============================
  
  - name: "Component Architecture"
    pattern: "components/**/*.js"
    type: "architecture"
    severity: "warning"
    checks:
      - rule: "single_responsibility"
        message: "ğŸ—ï¸ Composant avec trop de responsabilitÃ©s"
        threshold:
          hooks: 5
          state_variables: 8
          functions: 10
      
      - rule: "proper_imports"
        message: "ğŸ“¦ Imports manquants ou incorrects dÃ©tectÃ©s"
        check_patterns:
          - "useTheme from.*hooks/useTheme"  # DÃ©tecte l'import cassÃ©
        fix_suggestion: "Import depuis contexts/ThemeContext"

  # ===============================
  # RÃˆGLES SPÃ‰CIFIQUES AU PROJET
  # ===============================
  
  - name: "Get Weez Specific Rules"
    pattern: "**/*.js"
    type: "project_specific"
    severity: "info"
    checks:
      - rule: "mobile_desktop_duplication"
        message: "ğŸ“±ğŸ’» Code dupliquÃ© mobile/desktop dÃ©tectÃ©"
        pattern: "lg:hidden.*lg:block"
        fix_suggestion: "CrÃ©er des composants sÃ©parÃ©s MobileVersion/DesktopVersion"
      
      - rule: "theme_usage"
        message: "ğŸŒ“ Utilisation inconsistante du thÃ¨me"
        pattern: "isDarkMode.*?"
        threshold: 20
        fix_suggestion: "Utiliser des CSS variables ou un systÃ¨me de design tokens"

# ===============================
# CONFIGURATION DES NOTIFICATIONS
# ===============================

notifications:
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#dev-code-reviews"
    template: |
      ğŸ¤– *Rabbit Code Review* pour `{repository}`
      
      ğŸ“Š *RÃ©sumÃ©* :
      â€¢ âœ… {passed_rules} rÃ¨gles respectÃ©es
      â€¢ âš ï¸ {warnings} avertissements  
      â€¢ âŒ {errors} erreurs
      
      ğŸ“ *Fichiers analysÃ©s* : {files_count}
      ğŸ” *Branch* : `{branch}`
      ğŸ‘¤ *Auteur* : {author}
      
      {detailed_report}
  
  email:
    recipients:
      - "dev@getweez.com"
      - "architect@getweez.com"
    template: "detailed"
  
  github:
    create_pr_comment: true
    create_check_run: true
    template: |
      ## ğŸ¤– Rabbit Code Review
      
      ### ğŸ“Š RÃ©sumÃ© de l'analyse
      
      | MÃ©trique | Valeur |
      |----------|---------|
      | âœ… RÃ¨gles OK | {passed_rules} |
      | âš ï¸ Warnings | {warnings} |
      | âŒ Erreurs | {errors} |
      | ğŸ“ Fichiers | {files_count} |
      
      ### ğŸ¯ Actions RecommandÃ©es
      
      {action_items}
      
      <details>
      <summary>ğŸ“‹ Rapport DÃ©taillÃ©</summary>
      
      {detailed_report}
      
      </details>

# ===============================
# CONFIGURATION AVANCÃ‰E
# ===============================

analysis:
  # Exclure certains fichiers de l'analyse
  exclude_patterns:
    - "node_modules/**"
    - "dist/**" 
    - "build/**"
    - "*.test.js"
    - "*.spec.js"
    - "public/**"
  
  # Configuration spÃ©cifique par type de fichier
  file_types:
    javascript:
      max_complexity: 15
      max_functions_per_file: 10
      prefer_functional_components: true
    
    typescript:
      strict_types: true
      no_any: true
  
  # MÃ©triques personnalisÃ©es
  custom_metrics:
    - name: "chat_interface_health"
      description: "SantÃ© spÃ©cifique du composant ChatInterface"
      files: ["components/chat/ChatInterface.js"]
      checks:
        - max_lines: 200
        - max_hooks: 5
        - no_console_logs: true
        - proper_memoization: true

# ===============================
# INTÃ‰GRATIONS
# ===============================

integrations:
  github:
    enabled: true
    auto_assign_reviewers: true
    reviewers:
      - "senior-dev"
      - "tech-lead"
  
  jira:
    enabled: true
    create_tickets_for_errors: true
    project_key: "GETWEEZ"
  
  sonarqube:
    enabled: false  # DÃ©sactivÃ© pour l'instant
  
  bundle_analyzer:
    enabled: true
    threshold_mb: 5
    alert_on_increase: 10  # %

# ===============================
# RAPPORTS ET HISTORIQUE
# ===============================

reporting:
  generate_trends: true
  history_retention_days: 90
  weekly_summary: true
  
  dashboard:
    enabled: true
    url: "https://rabbit-dashboard.getweez.com"
  
  metrics_export:
    prometheus: true
    datadog: false

# ===============================
# CONFIGURATION DES FIXES AUTOMATIQUES
# ===============================

auto_fix:
  enabled: false  # DÃ©sactivÃ© par sÃ©curitÃ© au dÃ©but
  rules:
    - "remove_console_logs"
    - "fix_imports"
    - "format_code"
  
  safe_mode: true  # Demande confirmation avant fix
  create_pr: true  # CrÃ©e une PR pour les fixes

# ===============================
# ENVIRONNEMENTS
# ===============================

environments:
  development:
    severity_threshold: "info"
    notifications: ["slack"]
  
  staging:
    severity_threshold: "warning" 
    notifications: ["slack", "email"]
  
  production:
    severity_threshold: "error"
    notifications: ["slack", "email", "github"]
    block_deployment: true